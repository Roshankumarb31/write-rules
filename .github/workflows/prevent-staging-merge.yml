name: 'Prevent Staging Branch Merge'

on:
  pull_request:
    types: [opened, synchronize, reopened, edited]

jobs:
  block-staging-source:
    runs-on: ubuntu-latest
    name: 'Block staging as source branch'
    
    steps:
      - name: Display PR Information
        run: |
          echo "ğŸ” Checking PR details..."
          echo "ğŸ“¤ Source branch (HEAD): ${{ github.head_ref }}"
          echo "ğŸ“¥ Target branch (BASE): ${{ github.base_ref }}"
          echo "ğŸ‘¤ Author: ${{ github.actor }}"
          echo "ğŸ”— PR #${{ github.event.number }}"

      - name: Validate branch merge direction
        run: |
          SOURCE="${{ github.head_ref }}"
          TARGET="${{ github.base_ref }}"
          
          if [[ "$SOURCE" == "staging" ]]; then
            echo ""
            echo "ğŸš¨ =================================="
            echo "ğŸš¨   MERGE DIRECTION ERROR!"
            echo "ğŸš¨ =================================="
            echo ""
            echo "âŒ You're trying to merge FROM: $SOURCE"
            echo "âŒ                            TO: $TARGET"
            echo ""
            echo "ğŸ“‹ Our branching rules:"
            echo "   âœ… Any branch â†’ staging (ALLOWED)"
            echo "   âŒ staging â†’ any branch (BLOCKED)"
            echo ""
            echo "ğŸ’¡ What you should do instead:"
            echo "   1. Close this PR"
            echo "   2. Create a PR from '$TARGET' to 'staging'"
            echo "   3. Or merge your changes differently"
            echo ""
            echo "ğŸ¤” Need help? Check our branching guide!"
            echo ""
            exit 1
          else
            echo "âœ… Branch direction is valid!"
            echo "ğŸ“ Merging: $SOURCE â†’ $TARGET"
          fi

      - name: Success notification
        if: success()
        run: |
          echo ""
          echo "ğŸ‰ =================================="
          echo "ğŸ‰   PR VALIDATION PASSED!"
          echo "ğŸ‰ =================================="
          echo ""
          echo "âœ… Source: ${{ github.head_ref }}"
          echo "âœ… Target: ${{ github.base_ref }}"
          echo "âœ… Ready for review and merge!"
